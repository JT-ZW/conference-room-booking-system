{% extends "layout.html" %} {% block title %}Quotation #{{ quotation_number }} |
Rainbow Towers{% endblock %} {% block extra_css %}
<style>
  /* Print-specific styles */
  @media print {
    .no-print {
      display: none !important;
    }
    body {
      background-color: white !important;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 100% !important;
      width: 100% !important;
      padding: 0 !important;
    }
    .card {
      border: none !important;
      box-shadow: none !important;
      margin: 0 !important;
    }
    .card-body {
      padding: 0 !important;
    }
    @page {
      margin: 15mm;
      size: A4;
    }
    .page-break {
      page-break-before: always;
    }
    .gold-header,
    .gold-bar,
    .table-header {
      background-color: #d4a574 !important;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
  }

  /* Base document styles */
  body {
    font-family: "Century Gothic", "CenturyGothic", "AppleGothic", sans-serif;
  }

  .quotation-document {
    font-family: "Century Gothic", "CenturyGothic", "AppleGothic", sans-serif;
    background: white;
    max-width: 210mm;
    margin: 0 auto;
    color: #000;
    font-size: 11px;
    line-height: 1.4;
  }

  .document-container {
    padding: 20mm 15mm;
  }

  /* Logo and Header */
  .logo-section {
    text-align: center;
    margin-bottom: 15px;
  }

  .company-logo {
    max-width: 180px;
    height: auto;
    margin-bottom: 10px;
  }

  .company-address {
    font-size: 9px;
    color: #333;
    line-height: 1.3;
    margin-bottom: 5px;
  }

  .date-section {
    text-align: right;
    font-size: 10px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  /* Gold Header Bar */
  .gold-header {
    background-color: #d4a574;
    color: #000;
    text-align: center;
    padding: 10px;
    font-size: 16px;
    font-weight: bold;
    letter-spacing: 2px;
    margin-bottom: 15px;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Two Column Layout */
  .info-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 20px;
    font-size: 10px;
  }

  .info-column h3 {
    font-size: 11px;
    font-weight: bold;
    margin-bottom: 8px;
    text-decoration: underline;
  }

  .info-row {
    display: grid;
    grid-template-columns: 100px 1fr;
    margin-bottom: 4px;
  }

  .info-label {
    font-weight: bold;
  }

  /* Content Section */
  .content-label {
    font-size: 10px;
    font-weight: bold;
    margin: 15px 0 8px 0;
  }

  /* Table Styles */
  .items-table {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
    font-size: 10px;
  }

  .table-header {
    background-color: #d4a574;
    color: #000;
    font-weight: bold;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  .items-table th {
    padding: 8px 6px;
    text-align: left;
    border: 1px solid #999;
  }

  .items-table td {
    padding: 6px;
    border: 1px solid #999;
  }

  .items-table th.center,
  .items-table td.center {
    text-align: center;
  }

  .items-table th.right,
  .items-table td.right {
    text-align: right;
  }

  .total-row {
    background-color: #d4a574;
    font-weight: bold;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Terms Section - Page 2 */
  .terms-section {
    margin-top: 30px;
    font-size: 10px;
    line-height: 1.5;
  }

  .terms-section h2 {
    font-size: 12px;
    font-weight: bold;
    text-decoration: underline;
    margin-bottom: 10px;
  }

  .terms-section h3 {
    font-size: 11px;
    font-weight: bold;
    margin-top: 15px;
    margin-bottom: 8px;
  }

  .terms-section ul,
  .terms-section ol {
    margin: 5px 0;
    padding-left: 25px;
  }

  .terms-section li {
    margin-bottom: 5px;
  }

  .underline-text {
    text-decoration: underline;
    font-weight: bold;
  }

  /* Signature Section */
  .signature-section {
    margin-top: 40px;
    padding-top: 20px;
  }

  .signature-line {
    border-top: 1px solid #000;
    margin: 50px 0 5px 0;
    padding-top: 5px;
  }

  .signature-text {
    font-size: 10px;
  }

  /* Footer Gold Bar */
  .gold-bar {
    background-color: #d4a574;
    height: 15px;
    width: 100%;
    margin-top: 30px;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Action Buttons */
  .action-buttons {
    background: white;
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
  }
</style>
{% endblock %} {% block content %}
<!-- Action Buttons (Not Printed) -->
<div class="action-buttons no-print">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h5 class="mb-0">
        <i class="fas fa-file-invoice me-2"></i>Proforma Invoice / Quotation
      </h5>
    </div>
    <div>
      <a
        href="{{ url_for('view_booking', id=booking.id) }}"
        class="btn btn-secondary btn-sm"
      >
        <i class="fas fa-arrow-left me-1"></i>Back
      </a>
      <button
        type="button"
        class="btn btn-primary btn-sm"
        onclick="window.print()"
      >
        <i class="fas fa-print me-1"></i>Print
      </button>
      <button type="button" class="btn btn-success btn-sm" id="downloadPdf">
        <i class="fas fa-download me-1"></i>Download PDF
      </button>
    </div>
  </div>
</div>

<!-- Quotation Document -->
<div class="card shadow-sm border-0">
  <div class="card-body p-0">
    <div class="quotation-document" id="quotation-content">
      <div class="document-container">
        <!-- Page 1: Invoice Details -->
        <!-- Logo and Company Info -->
        <div class="logo-section">
          <img
            src="{{ url_for('static', filename='img/rainbow-towers-logo.png') }}"
            alt="The Rainbow Towers"
            class="company-logo"
          />
          <div class="company-address">
            1 Pennefather Avenue, P.O. Box 3033, Causeway, Harare, Zimbabwe<br />
            Tel: +263 242 2772633 - 9<br />
            Email: reservations@rtg.co.zw<br />
            Website: www.rtgafrica.com
          </div>
        </div>

        <!-- Date -->
        <div class="date-section">DATE: {{ now.strftime('%d %B %Y') }}</div>

        <!-- Gold Header Bar -->
        <div class="gold-header">PROFORMA INVOICE</div>

        <!-- Two Column Information -->
        <div class="info-columns">
          <!-- Left Column: Rainbow Towers -->
          <div class="info-column">
            <h3>Rainbow Towers</h3>
            <div class="info-row">
              <div class="info-label">Company:</div>
              <div></div>
            </div>
            <div class="info-row">
              <div class="info-label">Phone:</div>
              <div></div>
            </div>
            <div class="info-row">
              <div class="info-label">Mobile:</div>
              <div></div>
            </div>
            <div class="info-row">
              <div class="info-label">Email:</div>
              <div>reservations@rtg.co.zw</div>
            </div>
            <div class="info-row">
              <div class="info-label">Facebook:</div>
              <div></div>
            </div>
            <div class="info-row">
              <div class="info-label">Skype:</div>
              <div>rtgreservations</div>
            </div>
          </div>

          <!-- Right Column: VAT Registration & Banking -->
          <div class="info-column">
            <h3>Reference/Ref No/Yenyunyuro</h3>
            <div class="info-row">
              <div class="info-label"></div>
              <div>AN OT 2025 - 00034</div>
            </div>
            <br />
            <h3 style="margin-top: 10px">VAT REGISTRATION NUMBER</h3>
            <div class="info-row">
              <div class="info-label">VAT Number:</div>
              <div>10001325</div>
            </div>
            <div class="info-row">
              <div class="info-label">BP Number:</div>
              <div>088950</div>
            </div>
            <div class="info-row">
              <div class="info-label">Account Name:</div>
              <div>The Rainbow Towers</div>
            </div>
            <div class="info-row">
              <div class="info-label">Bank Name:</div>
              <div>Stanbic</div>
            </div>
            <div class="info-row">
              <div class="info-label">Branch:</div>
              <div>Station Newlands</div>
            </div>
            <div class="info-row">
              <div class="info-label">A/c Number:</div>
              <div>9140008958215</div>
            </div>
            <div class="info-row">
              <div class="info-label">Nostro FCA:</div>
              <div></div>
            </div>
          </div>
        </div>

        <!-- Contact Person -->
        <div class="info-row" style="margin-bottom: 15px">
          <div class="info-label">Contact Person:</div>
          <div>
            {% if booking.client %} {{ booking.client.contact_person or 'N/A' }}
            {% else %} N/A {% endif %}
          </div>
        </div>

        <div class="info-row" style="margin-bottom: 15px">
          <div class="info-label">Address:</div>
          <div>
            {% if booking.client %} {{ booking.client.address or 'N/A' }} {%
            else %} N/A {% endif %}
          </div>
        </div>

        <div class="info-row" style="margin-bottom: 15px">
          <div class="info-label">Phone:</div>
          <div>
            {% if booking.client %} {{ booking.client.phone or 'N/A' }} {% else
            %} N/A {% endif %}
          </div>
        </div>

        <div class="info-row" style="margin-bottom: 15px">
          <div class="info-label">Mobile:</div>
          <div></div>
        </div>

        <div class="info-row" style="margin-bottom: 15px">
          <div class="info-label">Email:</div>
          <div>
            {% if booking.client %} {{ booking.client.email or 'N/A' }} {% else
            %} N/A {% endif %}
          </div>
        </div>

        <!-- AN OT Content -->
        <div class="content-label">
          AN OT Content:
          <span style="font-weight: normal">
            {% if booking.start_time %} {% if booking.start_time is string %} {{
            booking.start_time[:10] }} {% else %} {{
            booking.start_time.strftime('%d/%m/%Y') }} {% endif %} {% else %}
            TBC {% endif %}
          </span>
        </div>

        <div style="font-weight: bold; margin: 10px 0">
          THE RAINBOW TOWERS HOTEL
        </div>

        <!-- Items Table -->
        <table class="items-table">
          <thead class="table-header">
            <tr>
              <th>REQUESTED SERVICE</th>
              <th class="center">NO. OF PAX</th>
              <th class="center">NO. OF ROOMS</th>
              <th class="right">UNIT PRICE/PER PERSON</th>
              <th class="center">NO. OF DAYS</th>
              <th class="right">TOTAL AMOUNT</th>
              <th class="right">US$</th>
            </tr>
          </thead>
          <tbody>
            {% set total_amount = 0 %}

            <!-- Custom Addons -->
            {% if booking.custom_addons %} {% for item in booking.custom_addons
            %}
            <tr>
              <td>{{ item.description or 'Service Item' }}</td>
              <td class="center">
                {% if 'pax' in item.description.lower() or 'person' in
                item.description.lower() %} {{ booking.attendees or
                item.quantity }} {% else %} - {% endif %}
              </td>
              <td class="center">
                {% if 'room' in item.description.lower() %} {{ item.quantity or
                1 }} {% else %} - {% endif %}
              </td>
              <td class="right">{{ "%.2f"|format(item.unit_price or 0) }}</td>
              <td class="center">{{ item.quantity or 1 }}</td>
              <td class="right">{{ "%.2f"|format(item.total_price or 0) }}</td>
              <td class="right"></td>
            </tr>
            {% set total_amount = total_amount + (item.total_price or 0) %} {%
            endfor %}

            <!-- Fallback to pricing_details -->
            {% elif booking.pricing_details %} {% if booking.pricing_details is
            string %} {% set pricing_data = booking.pricing_details|from_json %}
            {% else %} {% set pricing_data = booking.pricing_details %} {% endif
            %} {% if pricing_data and pricing_data.items %} {% for item in
            pricing_data.items %}
            <tr>
              <td>{{ item.description or 'Service Item' }}</td>
              <td class="center">{{ booking.attendees or '-' }}</td>
              <td class="center">-</td>
              <td class="right">{{ "%.2f"|format(item.unit_price or 0) }}</td>
              <td class="center">{{ item.quantity or 1 }}</td>
              <td class="right">{{ "%.2f"|format(item.total or 0) }}</td>
              <td class="right"></td>
            </tr>
            {% set total_amount = total_amount + (item.total or 0) %} {% endfor
            %} {% endif %} {% endif %}

            <!-- Fallback to total_price -->
            {% if total_amount == 0 and booking.total_price %}
            <tr>
              <td>
                {% if booking.room %} {{ booking.room.name }} - Conference Room
                {% else %} Conference Room Booking {% endif %}
              </td>
              <td class="center">{{ booking.attendees or '-' }}</td>
              <td class="center">1</td>
              <td class="right">
                {{ "%.2f"|format(booking.total_price or 0) }}
              </td>
              <td class="center">1</td>
              <td class="right">
                {{ "%.2f"|format(booking.total_price or 0) }}
              </td>
              <td class="right"></td>
            </tr>
            {% set total_amount = booking.total_price or 0 %} {% endif %}

            <!-- Total Row -->
            <tr class="total-row">
              <td colspan="5" style="text-align: right; padding-right: 10px">
                TOTAL US$
              </td>
              <td class="right">{{ "%.2f"|format(total_amount) }}</td>
              <td></td>
            </tr>
          </tbody>
        </table>

        <!-- Page Break for Terms -->
        <div class="page-break"></div>

        <!-- Page 2: Terms and Conditions -->
        <div class="terms-section">
          <h2>TERMS AND CONDITIONS</h2>

          <ol>
            <li>
              The hotel will provide all required equipment for the conference
              at a cost.
            </li>
            <li>
              The hotel shall not allow clients to bring own equipment as this
              is a service provided by the hotel. Equipment shall include but
              not limited to PA systems, screens, translation equipment………….
            </li>
            <li>
              All Equipment needs to be communicated at the point of making a
              reservation.
            </li>
            <li>
              100% of the total amount quoted is required within 48 hours of
              making an enquiry to guarantee your booking.
            </li>
            <li>Full payment is required for confirmation of the booking.</li>
            <li>Rates are subject to change without notice.</li>
          </ol>

          <h3 class="underline-text">AIRPORT TRANSFERS AND ACTIVITIES</h3>
          <p>
            <span class="underline-text"
              >The hotel through it's subsidiary Heritage Expeditions Africa
              (HExA) provides the following ground handling services:</span
            >
          </p>
          <p>
            Shuttle Service:<br />
            City Tours<br />
            Day Trips<br />
            Various Activities
          </p>

          <h3 class="underline-text">CANCELLATION POLICY</h3>
          <p>
            Accommodation and conference rooms booked are subject to the
            following policy:
          </p>
          <table style="width: 50%; margin-left: 0; font-size: 10px">
            <tr>
              <td>15 + Days</td>
              <td style="padding-left: 20px">50% refund is made</td>
            </tr>
            <tr>
              <td>8 - 14 Days</td>
              <td style="padding-left: 20px">25% refund is made</td>
            </tr>
            <tr>
              <td>0 - 7 Days</td>
              <td style="padding-left: 20px">No refund</td>
            </tr>
          </table>

          <h3 class="underline-text">PAYMENT</h3>
          <p>
            We require confirmation of payment 2 weeks before arrival to secure
            your booking. Payment can be a purchase order, cash or bank
            transfer.<br />
            Please note that we hold the right to cancel your reservation if we
            have not received your full payment on order or letter of commitment
            to pay from government/corporate organisations if on credit or the
            booking has not been confirmed by a RTGH payment before the above
            stated booking.<br />
            It will only remain a quotation and may only constitute an
            undertaking to provide services after both payment has been made and
            the booking confirmed.
          </p>

          <h3 class="underline-text">
            INCREASE IN NUMBERS OR ADDITIONAL SERVICES
          </h3>
          <p>
            Day conferences – numbers to be communicated by 0900hrs<br />
            Lunch Bookings – numbers to be communicated by 0900hrs<br />
            Dinner/ Cocktail bookings – numbers to be communicated by 1200hrs<br />
            Please note that if there is no communication regarding the
            reduction of numbers, the hotel will charge as per original booking
            numbers.<br />
            In the event of an increase in numbers for either conferencing or
            accommodation bookings, the hotel will charge accordingly and your
            organisation will be required to provide order, written confirmation
            of payment within 24 hours.
          </p>

          <h3 class="underline-text">NO SHOWS</h3>
          <p>
            Guests with a valid room reservation who do not arrive on the day of
            the reservation will be considered no-shows and the applicable room
            rate equal to one night stay will be charged.
          </p>

          <!-- Signature Section -->
          <div class="signature-section">
            <p style="font-weight: bold; margin-bottom: 30px">
              If in agreement, please sign and return copy to certify
              confirmation
            </p>

            <div
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 50px"
            >
              <div>
                <div class="signature-line">
                  <span class="signature-text"
                    >Name ………………………………………………………… Signature
                    …………………………………………………………………</span
                  >
                </div>
              </div>
              <div>
                <div class="signature-line">
                  <span class="signature-text">Date……………………………………………</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Gold Footer Bar -->
        <div class="gold-bar"></div>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document
      .getElementById("downloadPdf")
      .addEventListener("click", function () {
        const button = this;
        const originalText = button.innerHTML;

        button.innerHTML =
          '<i class="fas fa-spinner fa-spin me-1"></i>Generating...';
        button.disabled = true;

        const options = {
          margin: 15,
          filename: "proforma-invoice-{{ quotation_number }}.pdf",
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2, useCORS: true, letterRendering: true },
          jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
          pagebreak: { mode: ["avoid-all", "css", "legacy"] },
        };

        const element = document.getElementById("quotation-content");

        html2pdf()
          .set(options)
          .from(element)
          .save()
          .then(() => {
            button.innerHTML = originalText;
            button.disabled = false;
          })
          .catch((error) => {
            console.error("PDF generation error:", error);
            button.innerHTML = originalText;
            button.disabled = false;
            alert("Error generating PDF. Please try printing instead.");
          });
      });
  });
</script>
{% endblock %}
