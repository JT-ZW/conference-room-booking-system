{% extends "layout.html" %} {% block title %}{{ client.company_name or
client.contact_person }} | Rainbow Towers Conference Booking{% endblock %} {%
block extra_css %}
<style>
  .client-header {
    border-left: 4px solid #4e73df;
    padding-left: 1rem;
  }

  .booking-item {
    border-left: 4px solid;
    transition: transform 0.2s;
  }

  .booking-item:hover {
    transform: translateX(5px);
  }

  .booking-tentative {
    border-color: #f6c23e;
  }
  .booking-confirmed {
    border-color: #1cc88a;
  }
  .booking-cancelled {
    border-color: #e74a3b;
  }
</style>
{% endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="client-header">
    {{ client.company_name or client.contact_person }}
  </h1>
  <div>
    <a href="{{ url_for('clients') }}" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left me-1"></i>Back to Clients
    </a>
    <a
      href="{{ url_for('edit_client', id=client.id) }}"
      class="btn btn-warning ms-2"
    >
      <i class="fas fa-edit me-1"></i>Edit Client
    </a>
    <a
      href="{{ url_for('new_booking') }}?client={{ client.id }}"
      class="btn btn-success ms-2"
    >
      <i class="fas fa-plus me-1"></i>New Booking
    </a>
  </div>
</div>

<div class="row">
  <!-- Client Details -->
  <div class="col-lg-4 mb-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-white">
        <h5 class="mb-0 text-primary">
          <i class="fas fa-info-circle me-2"></i>Client Details
        </h5>
      </div>
      <div class="card-body">
        {% if client.company_name %}
        <div class="mb-3">
          <h6 class="text-muted mb-1">Company</h6>
          <p class="mb-0 fw-bold">{{ client.company_name }}</p>
        </div>
        {% endif %}

        <div class="mb-3">
          <h6 class="text-muted mb-1">Contact Person</h6>
          <p class="mb-0">{{ client.contact_person }}</p>
        </div>

        <div class="mb-3">
          <h6 class="text-muted mb-1">Email</h6>
          <p class="mb-0">
            <a href="mailto:{{ client.email }}">{{ client.email }}</a>
          </p>
        </div>

        {% if client.phone %}
        <div class="mb-3">
          <h6 class="text-muted mb-1">Phone</h6>
          <p class="mb-0">{{ client.phone }}</p>
        </div>
        {% endif %} {% if client.address %}
        <div class="mb-3">
          <h6 class="text-muted mb-1">Address</h6>
          <p class="mb-0">{{ client.address|nl2br }}</p>
        </div>
        {% endif %} {% if client.notes %}
        <div class="mb-0">
          <h6 class="text-muted mb-1">Notes</h6>
          <p class="mb-0">{{ client.notes|nl2br }}</p>
        </div>
        {% endif %}
      </div>
      <div class="card-footer bg-white">
        <div class="d-flex justify-content-between">
          <span class="text-muted small">
            <i class="fas fa-clock me-1"></i>Client since {{
            client.created_at.strftime('%b %Y') }}
          </span>
          <span class="badge bg-primary">
            {{ bookings|length }} Booking{% if bookings|length != 1 %}s{% endif
            %}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Client Bookings -->
  <div class="col-lg-8 mb-4">
    <div class="card shadow-sm border-0 h-100">
      <div
        class="card-header bg-white d-flex justify-content-between align-items-center"
      >
        <h5 class="mb-0 text-primary">
          <i class="fas fa-calendar-alt me-2"></i>Bookings History
        </h5>
        <div class="btn-group">
          <button
            class="btn btn-sm btn-outline-secondary active"
            id="allBookingsBtn"
          >
            All
          </button>
          <button
            class="btn btn-sm btn-outline-secondary"
            id="upcomingBookingsBtn"
          >
            Upcoming
          </button>
          <button class="btn btn-sm btn-outline-secondary" id="pastBookingsBtn">
            Past
          </button>
        </div>
      </div>
      <div class="card-body p-0">
        {% if bookings %}
        <div class="list-group list-group-flush" id="bookingsList">
          {% for booking in bookings %}
          <a
            href="{{ url_for('view_booking', id=booking.id) }}"
            class="list-group-item list-group-item-action booking-item booking-{{ booking.status }} {% if booking.end_time < now %}booking-past{% else %}booking-upcoming{% endif %}"
          >
            <div
              class="d-flex w-100 justify-content-between align-items-center"
            >
              <div>
                <h5 class="mb-1">{{ booking.title }}</h5>
                <p class="mb-1 text-muted">
                  <i class="fas fa-door-open me-1"></i>{{ booking.room.name }}
                </p>
              </div>
              <div class="text-end">
                <span
                  class="badge bg-{% if booking.status == 'tentative' %}warning{% elif booking.status == 'confirmed' %}success{% else %}danger{% endif %}"
                >
                  {{ booking.status|capitalize }}
                </span>
                <div class="small text-muted mt-1">
                  {{ booking.start_time.strftime('%d %b %Y') }}<br />
                  {{ booking.start_time.strftime('%H:%M') }} - {{
                  booking.end_time.strftime('%H:%M') }}
                </div>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
        {% else %}
        <div class="p-5 text-center">
          <p class="text-muted mb-3">No bookings found for this client.</p>
          <a
            href="{{ url_for('new_booking') }}?client={{ client.id }}"
            class="btn btn-primary"
          >
            <i class="fas fa-plus me-1"></i>Create First Booking
          </a>
        </div>
        {% endif %}
      </div>
      {% if bookings %}
      <div class="card-footer bg-white text-center">
        <a
          href="{{ url_for('new_booking') }}?client={{ client.id }}"
          class="btn btn-primary"
        >
          <i class="fas fa-plus me-1"></i>Create New Booking
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const allBtn = document.getElementById("allBookingsBtn");
    const upcomingBtn = document.getElementById("upcomingBookingsBtn");
    const pastBtn = document.getElementById("pastBookingsBtn");

    const bookingItems = document.querySelectorAll(".booking-item");

    // Show all bookings
    allBtn.addEventListener("click", function () {
      allBtn.classList.add("active");
      upcomingBtn.classList.remove("active");
      pastBtn.classList.remove("active");

      bookingItems.forEach((item) => {
        item.style.display = "block";
      });
    });

    // Show only upcoming bookings
    upcomingBtn.addEventListener("click", function () {
      allBtn.classList.remove("active");
      upcomingBtn.classList.add("active");
      pastBtn.classList.remove("active");

      bookingItems.forEach((item) => {
        if (item.classList.contains("booking-upcoming")) {
          item.style.display = "block";
        } else {
          item.style.display = "none";
        }
      });
    });

    // Show only past bookings
    pastBtn.addEventListener("click", function () {
      allBtn.classList.remove("active");
      upcomingBtn.classList.remove("active");
      pastBtn.classList.add("active");

      bookingItems.forEach((item) => {
        if (item.classList.contains("booking-past")) {
          item.style.display = "block";
        } else {
          item.style.display = "none";
        }
      });
    });
  });
</script>
{% endblock %}
