{% extends "layout.html" %} {% block title %}Reports Dashboard | Rainbow Towers
Conference Booking{% endblock %} {% block extra_css %}
<style>
  :root {
    --primary-color: #2c5aa0;
    --secondary-color: #4a90a4;
    --accent-color: #7fb069;
    --warning-color: #f4a261;
    --light-bg: #f8fafb;
    --card-shadow: 0 2px 10px rgba(44, 90, 160, 0.08);
    --hover-shadow: 0 4px 20px rgba(44, 90, 160, 0.15);
    --border-radius: 12px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  body {
    background-color: var(--light-bg);
    font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }

  .dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem;
  }

  /* Header Section */
  .dashboard-header {
    background: linear-gradient(
      135deg,
      var(--primary-color) 0%,
      var(--secondary-color) 100%
    );
    color: white;
    border-radius: var(--border-radius);
    padding: 2.5rem 2rem;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }

  .dashboard-header::before {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>')
      repeat;
    opacity: 0.3;
  }

  .dashboard-header .content {
    position: relative;
    z-index: 1;
  }

  .header-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    letter-spacing: -0.025em;
  }

  .header-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 1rem;
    font-weight: 400;
  }

  .header-meta {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    font-size: 0.9rem;
    opacity: 0.8;
  }

  .header-meta .badge {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-weight: 500;
  }

  /* Quick Stats Section */
  .quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2.5rem;
  }

  .stat-card {
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--card-shadow);
    transition: var(--transition);
    border: 1px solid rgba(44, 90, 160, 0.05);
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--accent-color);
    transition: var(--transition);
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-shadow);
  }

  .stat-card:hover::before {
    width: 6px;
  }

  .stat-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: white;
  }

  .stat-icon.primary {
    background: var(--primary-color);
  }
  .stat-icon.secondary {
    background: var(--secondary-color);
  }
  .stat-icon.accent {
    background: var(--accent-color);
  }
  .stat-icon.warning {
    background: var(--warning-color);
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
    line-height: 1;
  }

  .stat-label {
    color: #64748b;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }

  .stat-trend {
    font-size: 0.8rem;
    color: #64748b;
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .trend-positive {
    color: var(--accent-color);
  }
  .trend-neutral {
    color: #64748b;
  }

  /* Main Reports Grid */
  .reports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 2rem;
    margin-bottom: 2.5rem;
  }

  .report-card {
    background: white;
    border-radius: var(--border-radius);
    padding: 0;
    box-shadow: var(--card-shadow);
    transition: var(--transition);
    border: 1px solid rgba(44, 90, 160, 0.05);
    overflow: hidden;
    position: relative;
  }

  .report-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--hover-shadow);
  }

  .report-header {
    padding: 1.5rem 1.5rem 1rem;
    position: relative;
  }

  .report-daily {
    border-color: #1cc88a;
  }

  .report-weekly {
    border-color: #36b9cc;
  }

  .report-monthly {
    border-color: #f6c23e;
  .report-type-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(44, 90, 160, 0.1);
    color: var(--primary-color);
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .report-icon-wrapper {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    font-size: 1.5rem;
    color: white;
  }

  .daily-report .report-icon-wrapper {
    background: var(--accent-color);
  }
  .weekly-report .report-icon-wrapper {
    background: var(--secondary-color);
  }
  .monthly-report .report-icon-wrapper {
    background: var(--warning-color);
  }

  .report-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    line-height: 1.2;
  }

  .report-description {
    color: #64748b;
    font-size: 0.95rem;
    line-height: 1.5;
    margin-bottom: 1.5rem;
  }

  .report-features {
    list-style: none;
    padding: 0;
    margin: 0 0 1.5rem 0;
  }

  .report-features li {
    color: #64748b;
    font-size: 0.9rem;
    padding: 0.375rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .report-features li::before {
    content: "âœ“";
    color: var(--accent-color);
    font-weight: 600;
    font-size: 0.875rem;
  }

  .report-footer {
    padding: 0 1.5rem 1.5rem;
    margin-top: auto;
  }

  .report-actions {
    display: flex;
    gap: 0.75rem;
    align-items: center;
  }

  .btn-report {
    flex: 1;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1rem;
    font-weight: 600;
    font-size: 0.9rem;
    transition: var(--transition);
    text-decoration: none;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .btn-report:hover {
    background: #1e3a8a;
    color: white;
    transform: translateY(-1px);
  }

  .btn-download {
    background: rgba(44, 90, 160, 0.1);
    color: var(--primary-color);
    border: 1px solid rgba(44, 90, 160, 0.2);
    border-radius: 8px;
    padding: 0.75rem;
    font-size: 0.9rem;
    transition: var(--transition);
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn-download:hover {
    background: rgba(44, 90, 160, 0.15);
    color: var(--primary-color);
  }

  /* Quick Actions */
  .quick-actions {
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--card-shadow);
    margin-bottom: 2rem;
  }

  .actions-header {
    display: flex;
    align-items: center;
    justify-content: between;
    margin-bottom: 1rem;
  }

  .actions-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
  }

  .actions-subtitle {
    color: #64748b;
    font-size: 0.9rem;
  }

  .action-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .btn-action {
    background: rgba(44, 90, 160, 0.06);
    color: var(--primary-color);
    border: 1px solid rgba(44, 90, 160, 0.1);
    border-radius: 8px;
    padding: 0.625rem 1.25rem;
    font-weight: 500;
    font-size: 0.9rem;
    transition: var(--transition);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-action:hover {
    background: rgba(44, 90, 160, 0.1);
    color: var(--primary-color);
    transform: translateY(-1px);
  }

  /* System Status */
  .system-status {
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--card-shadow);
    border-left: 4px solid var(--accent-color);
  }

  .status-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #f1f5f9;
  }

  .status-item:last-child {
    border-bottom: none;
  }

  .status-label {
    color: #64748b;
    font-size: 0.9rem;
  }

  .status-value {
    font-weight: 600;
    color: var(--primary-color);
  }

  .status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent-color);
    margin-left: 0.5rem;
  }

  /* Loading States */
  .loading-skeleton {
    background: linear-gradient(90deg, #f0f4f8 25%, #e2e8f0 50%, #f0f4f8 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 4px;
    height: 1.5rem;
  }

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* Error States */
  .error-message {
    background: #fef2f2;
    border: 1px solid #fecaca;
    border-radius: 8px;
    padding: 1rem;
    color: #dc2626;
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }

  .warning-message {
    background: #fffbeb;
    border: 1px solid #fed7aa;
    border-radius: 8px;
    padding: 1rem;
    color: #d97706;
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .dashboard-container {
      padding: 1rem;
    }

    .header-title {
      font-size: 2rem;
    }

    .quick-stats {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .reports-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .report-actions {
      flex-direction: column;
    }

    .action-buttons {
      flex-direction: column;
    }

    .header-meta {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }
  }

  @media (max-width: 480px) {
    .stat-card {
      padding: 1rem;
    }

    .stat-value {
      font-size: 1.5rem;
    }

    .report-card {
      margin-bottom: 1rem;
    }
  }

  /* Animation for cards appearing */
  .animate-in {
    opacity: 0;
    transform: translateY(20px);
    animation: slideIn 0.6s ease-out forwards;
  }

  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Focus states for accessibility */
  .btn-report:focus,
  .btn-download:focus,
  .btn-action:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
  }

  .download-options {
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    padding: 0.5rem;
    margin-top: 0.5rem;
  }

  .download-btn {
    font-size: 0.875rem;
    padding: 0.375rem 0.75rem;
    margin: 0.125rem;
  }
</style>
{% endblock %} {% block content %}
<!-- Page Header -->
<div class="page-header text-center">
  <div class="container">
    <h1 class="display-5 mb-3">
      <i class="fas fa-chart-bar me-3"></i>Reports & Analytics
    </h1>
    <p class="lead mb-0">
      Comprehensive conference room booking reports and daily operations
      summaries
    </p>
    <small class="text-light opacity-75 d-block mt-2">
      <i class="fas fa-clock me-1"></i>Last updated: {{ now.strftime('%d %B %Y
  at %H:%M CAT') if now else 'Unknown' }}
    </small>
<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="content">
      <h1 class="header-title">
        <i class="fas fa-chart-line me-2"></i>Reports Dashboard
      </h1>
      <p class="header-subtitle">
        Comprehensive conference room booking analytics and operational reports
      </p>
      <div class="header-meta">
        <div class="d-flex align-items-center">
          <i class="fas fa-clock me-2"></i>
          <span
            >Last updated:
            <strong
              >{{ moment().strftime('%B %d, %Y at %I:%M %p') if moment else
              'Unknown Time' }}</strong
            ></span
          >
        </div>
        <div class="badge">
          <i class="fas fa-database me-1"></i>
          Live Data
        </div>
        {% if current_user.is_authenticated %}
        <div class="d-flex align-items-center">
          <i class="fas fa-user me-2"></i>
          <span
            >{{ current_user.first_name }} {{ current_user.last_name }}</span
          >
        </div>
        {% endif %}
      </div>
    </div>
  </div>

<!-- Overview Statistics -->
<div class="stats-overview rounded-3 mb-4" id="statsOverview">
  <div class="container py-4">
    {% if stats %}
    <div class="row text-center" id="statsGrid">
      <!-- Today's Bookings -->
      <div class="col-md-3 mb-3">
        <div
          class="stats-card rounded p-3 h-100"
          onclick="showStatsDetails('today')"
        >
          <i class="fas fa-calendar-day fa-2x mb-2"></i>
          <div class="stat-value" id="todayValue">
            {{ stats.current_month_bookings|default(0) }}
          </div>
          <div class="stat-label">Today's Events</div>
          {% if stats.current_month_bookings and stats.current_month_bookings >
          0 %}
          <div class="stat-trend">
            <i class="fas fa-arrow-up text-success me-1"></i>
            Active today
          </div>
          {% else %}
          <div class="stat-trend no-data-state">No events today</div>
          {% endif %}
  <!-- Quick Stats Section -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="text-muted mb-0">Quick Stats</h5>
    <div
      id="refresh-indicator"
      class="text-muted"
      style="font-size: 12px; display: none"
    >
      <i class="fas fa-sync-alt fa-spin me-1"></i>Refreshing...
    </div>
  </div>
  <div class="quick-stats">
    <div class="stat-card animate-in" style="animation-delay: 0.1s">
      <div class="stat-header">
        <div>
          <div class="stat-value" id="todayEvents">
            <span
              class="loading-skeleton"
              style="width: 60px; display: inline-block"
            ></span>
          </div>
          <div class="stat-label">Today's Events</div>
          <div class="stat-trend">
            <i class="fas fa-calendar-day me-1"></i>
            <span id="todayTrend">Loading...</span>
          </div>
        </div>
        <div class="stat-icon primary">
          <i class="fas fa-calendar-day"></i>
        </div>
      </div>
    </div>

      <!-- This Week's Revenue -->
      <div class="col-md-3 mb-3">
        <div
          class="stats-card rounded p-3 h-100"
          onclick="showStatsDetails('week')"
        >
          <i class="fas fa-dollar-sign fa-2x mb-2"></i>
          <div class="stat-value" id="weekValue">
            {% if stats.current_month_revenue %} {% if
            stats.current_month_revenue >= 1000 %} ${{
            "%.0f"|format(stats.current_month_revenue) }} {% else %} ${{
            "%.2f"|format(stats.current_month_revenue) }} {% endif %} {% else %}
            $0 {% endif %}
          </div>
          <div class="stat-label">This Week's Revenue</div>
          {% if stats.avg_booking_value and stats.avg_booking_value > 0 %}
    <div class="stat-card animate-in" style="animation-delay: 0.2s">
      <div class="stat-header">
        <div>
          <div class="stat-value" id="weeklyRevenue">
            <span
              class="loading-skeleton"
              style="width: 80px; display: inline-block"
            ></span>
          </div>
          <div class="stat-label">This Week's Revenue</div>
          <div class="stat-trend">
            <i class="fas fa-dollar-sign me-1"></i>
            <span id="weeklyTrend">Loading...</span>
          </div>
        </div>
        <div class="stat-icon accent">
          <i class="fas fa-dollar-sign"></i>
        </div>
      </div>
    </div>

    <div class="stat-card animate-in" style="animation-delay: 0.3s">
      <div class="stat-header">
        <div>
          <div class="stat-value" id="activeRooms">
            <span
              class="loading-skeleton"
              style="width: 40px; display: inline-block"
            ></span>
          </div>
          <div class="stat-label">Active Rooms</div>
          <div class="stat-trend">
            <i class="fas fa-door-open me-1"></i>
            <span id="roomsTrend">Loading...</span>
          </div>
        </div>
      </div>

      <!-- Utilization Rate -->
      <div class="col-md-3 mb-3">
        <div
          class="stats-card rounded p-3 h-100"
          onclick="showStatsDetails('utilization')"
        >
          <i class="fas fa-chart-line fa-2x mb-2"></i>
          <div class="stat-value" id="utilizationValue">
            {{ stats.utilization_rate|default(0) }}%
          </div>
          <div class="stat-label">Room Utilization</div>
          {% if stats.utilization_rate %} {% if stats.utilization_rate >= 70 %}
          <div class="stat-trend">
            <i class="fas fa-arrow-up text-success me-1"></i>
            High utilization
          </div>
          {% elif stats.utilization_rate >= 30 %}
          <div class="stat-trend">
            <i class="fas fa-minus text-warning me-1"></i>
            Moderate utilization
          </div>
          {% else %}
          <div class="stat-trend">
            <i class="fas fa-arrow-down text-info me-1"></i>
            Room for improvement
          </div>
          {% endif %} {% else %}
          <div class="stat-trend no-data-state">No utilization data</div>
          {% endif %}
        </div>
      </div>
    </div>
    {% else %}
    <!-- Loading State -->
    <div class="row text-center" id="loadingState">
      <div class="col-12">
        <div class="text-center py-4">
          <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
          <div class="h5">Loading statistics...</div>
          <small class="text-light opacity-75"
            >Please wait while we fetch your data</small
          >
        <div class="stat-icon secondary">
          <i class="fas fa-door-open"></i>
        </div>
      </div>
    </div>

    <div class="stat-card animate-in" style="animation-delay: 0.4s">
      <div class="stat-header">
        <div>
          <div class="stat-value" id="utilization">
            <span
              class="loading-skeleton"
              style="width: 50px; display: inline-block"
            ></span>
          </div>
          <div class="stat-label">Room Utilization</div>
          <div class="stat-trend">
            <i class="fas fa-chart-line me-1"></i>
            <span id="utilizationTrend">Loading...</span>
          </div>
        </div>
        <div class="stat-icon warning">
          <i class="fas fa-chart-line"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Error/Warning Messages -->
  <div id="errorContainer" style="display: none"></div>

  <!-- Quick Actions -->
  <div class="quick-actions animate-in" style="animation-delay: 0.5s">
    <div class="actions-header">
      <div>
        <div class="actions-title">
          <i class="fas fa-bolt me-2"></i>Quick Actions
        </div>
        <div class="actions-subtitle">
          Generate reports instantly or navigate to specific dates
        </div>
      </div>
    </div>
    <div class="action-buttons">
      <a href="#" class="btn-action" onclick="generateTomorrowReport()">
        <i class="fas fa-calendar-plus"></i>
        Tomorrow's Report
      </a>
      <a href="#" class="btn-action" onclick="generateThisWeekReport()">
        <i class="fas fa-calendar-week"></i>
        This Week's Summary
      </a>
      <a href="#" class="btn-action" onclick="generateThisMonthReport()">
        <i class="fas fa-calendar-alt"></i>
        This Month's Report
      </a>
      <a href="#" class="btn-action" onclick="showCustomDateModal()">
        <i class="fas fa-calendar"></i>
        Custom Date Range
      </a>
      {% endif %}
    </div>
  </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div class="quick-actions">
  <div class="row align-items-center">
    <div class="col-md-8">
      <h5 class="mb-2">
        <i class="fas fa-bolt text-primary me-2"></i>Quick Actions
      </h5>
      <p class="text-muted mb-md-0">
        Generate reports for specific date ranges, download daily summaries, or
        view operational analytics.
      </p>
    </div>
    <div class="col-md-4 text-md-end">
      <button class="btn btn-primary me-2" onclick="generateTomorrowReport()">
        <i class="fas fa-calendar-plus me-1"></i>Tomorrow's Report
      </button>
      <button class="btn btn-outline-primary" onclick="showDateRangeModal()">
        <i class="fas fa-calendar-alt me-1"></i>Custom Range
      </button>
    </div>
  </div>
</div>

<!-- Reports Grid -->
<div class="row">
  <!-- Room Utilization Report -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm border-0 h-100 report-card report-utilization">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start mb-3">
          <div class="report-icon-wrapper bg-primary-soft me-3">
            <i class="fas fa-chart-pie fa-2x text-primary"></i>
          </div>
          <div class="flex-grow-1">
            <h5 class="card-title mb-1">Room Utilization Analysis</h5>
            <div class="text-muted small">Track conference room efficiency</div>
          </div>
        </div>

        <p class="card-text mb-3">
          Analyze how efficiently your conference rooms are being utilized.
          Identify peak usage periods, underutilized spaces, and optimization
          opportunities for better resource management.
        </p>

        <ul class="feature-list mb-4 flex-grow-1">
          <li>Utilization rates by room and time period</li>
          <li>Peak vs. off-peak usage analysis</li>
          <li>Room capacity vs. actual usage</li>
          <li>Revenue per room performance</li>
          <li>Booking frequency and duration patterns</li>
        </ul>

        <div class="mt-auto">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <small class="text-muted">
              <i class="fas fa-clock me-1"></i>Real-time data
            </small>
            <span class="badge bg-primary">Popular</span>
          </div>
          <a
            href="{{ url_for('room_utilization_report') }}"
            class="btn btn-primary btn-report w-100"
          >
            <i class="fas fa-chart-pie me-2"></i>View Utilization Report
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Daily Summary Report -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm border-0 h-100 report-card report-daily">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start mb-3">
          <div class="report-icon-wrapper bg-success-soft me-3">
            <i class="fas fa-calendar-day fa-2x text-success"></i>
          </div>
          <div class="flex-grow-1">
            <h5 class="card-title mb-1">Daily Summary Report</h5>
            <div class="text-muted small">Next day events breakdown</div>
          </div>
        </div>

        <p class="card-text mb-3">
          Get a comprehensive breakdown of all events scheduled for the
          following day. Perfect for daily operations planning and staff
          coordination with detailed event information and room assignments.
        </p>

        <ul class="feature-list mb-4 flex-grow-1">
          <li>Tomorrow's complete event schedule</li>
          <li>Room-by-room event breakdown</li>
          <li>Client details and contact information</li>
          <li>Event timing and duration</li>
          <li>Attendee counts and special requirements</li>
        </ul>

        <div class="mt-auto">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <small class="text-muted">
              <i class="fas fa-clock me-1"></i>Updated daily at 6 PM
            </small>
            <span class="badge bg-success">Essential</span>
          </div>
          <a
            href="{{ url_for('daily_summary_report') }}"
            class="btn btn-success btn-report w-100"
          >
            <i class="fas fa-calendar-day me-2"></i>View Daily Summary
          </a>
          <div class="download-options mt-2">
            <small class="text-muted d-block mb-1">Quick Download:</small>
            <button
              class="btn btn-outline-success btn-sm download-btn"
              onclick="downloadDailyExcel()"
            >
              <i class="fas fa-file-excel me-1"></i>Excel
            </button>
            <button
              class="btn btn-outline-success btn-sm download-btn"
              onclick="downloadDailyPDF()"
            >
              <i class="fas fa-file-pdf me-1"></i>PDF
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Summary Report -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm border-0 h-100 report-card report-weekly">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start mb-3">
          <div class="report-icon-wrapper bg-info-soft me-3">
            <i class="fas fa-calendar-week fa-2x text-info"></i>
          </div>
          <div class="flex-grow-1">
            <h5 class="card-title mb-1">Weekly Summary Report</h5>
            <div class="text-muted small">Week-at-a-glance overview</div>
          </div>
        </div>

        <p class="card-text mb-3">
          Comprehensive weekly overview showing all rooms and their scheduled
          events in a table format. Perfect for weekly planning, resource
          allocation, and identifying busy periods across all facilities.
        </p>

        <ul class="feature-list mb-4 flex-grow-1">
          <li>7-day room schedule grid view</li>
          <li>All rooms and events in one view</li>
          <li>Event details with pricing information</li>
          <li>Client and attendee information</li>
          <li>Weekly utilization summary</li>
        </ul>

        <div class="mt-auto">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <small class="text-muted">
              <i class="fas fa-clock me-1"></i>Updated every Monday
            </small>
            <span class="badge bg-info">Planning</span>
          </div>
          <a
            href="{{ url_for('weekly_summary_report') }}"
            class="btn btn-info btn-report w-100"
          >
            <i class="fas fa-calendar-week me-2"></i>View Weekly Summary
          </a>
          <div class="download-options mt-2">
            <small class="text-muted d-block mb-1">Download Options:</small>
            <button
              class="btn btn-outline-info btn-sm download-btn"
              onclick="downloadWeeklyExcel()"
            >
              <i class="fas fa-file-excel me-1"></i>Excel
            </button>
            <button
              class="btn btn-outline-info btn-sm download-btn"
              onclick="downloadWeeklyPDF()"
            >
              <i class="fas fa-file-pdf me-1"></i>PDF
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Monthly Report -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm border-0 h-100 report-card report-monthly">
      <div class="card-body d-flex flex-column">
        <div class="d-flex align-items-start mb-3">
          <div class="report-icon-wrapper bg-warning-soft me-3">
            <i class="fas fa-calendar-alt fa-2x text-warning"></i>
          </div>
          <div class="flex-grow-1">
            <h5 class="card-title mb-1">Monthly Performance Report</h5>
            <div class="text-muted small">Comprehensive monthly analytics</div>
          </div>
        </div>

        <p class="card-text mb-3">
          Detailed monthly performance analysis combining utilization, revenue,
          and operational metrics. Perfect for management reviews, performance
          tracking, and strategic planning decisions.
        </p>

        <ul class="feature-list mb-4 flex-grow-1">
          <li>Monthly revenue and booking summaries</li>
          <li>Room performance comparisons</li>
          <li>Client activity and trends</li>
          <li>Utilization vs. target analysis</li>
          <li>Executive summary with insights</li>
        </ul>

        <div class="mt-auto">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <small class="text-muted">
              <i class="fas fa-clock me-1"></i>Generated monthly
            </small>
            <span class="badge bg-warning">Executive</span>
          </div>
          <a
            href="{{ url_for('monthly_report') }}"
            class="btn btn-warning btn-report w-100"
          >
            <i class="fas fa-calendar-alt me-2"></i>View Monthly Report
          </a>
          <div class="download-options mt-2">
            <small class="text-muted d-block mb-1">Export Formats:</small>
            <button
              class="btn btn-outline-warning btn-sm download-btn"
              onclick="downloadMonthlyExcel()"
            >
              <i class="fas fa-file-excel me-1"></i>Excel
            </button>
            <button
              class="btn btn-outline-warning btn-sm download-btn"
              onclick="downloadMonthlyPDF()"
            >
              <i class="fas fa-file-pdf me-1"></i>PDF
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Additional Information -->
<div class="row mt-4">
  <div class="col-md-8">
    <div class="card shadow-sm border-0">
      <div class="card-header bg-white">
        <h6 class="mb-0 text-primary">
          <i class="fas fa-info-circle me-2"></i>Report Information
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6>Data Sources</h6>
            <ul class="text-muted">
              <li>Real-time booking database</li>
              <li>Room configuration and pricing</li>
              <li>Client information and history</li>
              <li>Event schedules and assignments</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h6>Report Features</h6>
            <ul class="text-muted">
              <li>Excel and PDF export options</li>
              <li>Custom date range filtering</li>
              <li>Automated daily generation</li>
              <li>Mobile-friendly viewing</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card shadow-sm border-0">
      <div class="card-header bg-white">
        <h6 class="mb-0 text-primary">
          <i class="fas fa-download me-2"></i>Quick Downloads
        </h6>
      </div>
      <div class="card-body">
        <p class="text-muted mb-3">
          Download today's and tomorrow's reports instantly:
        </p>
        <div class="d-grid gap-2">
          <button
            class="btn btn-outline-primary btn-sm"
            onclick="downloadTodayReport()"
          >
            <i class="fas fa-file-excel me-1"></i>Today's Summary (Excel)
          </button>
          <button
            class="btn btn-outline-success btn-sm"
            onclick="downloadTomorrowReport()"
          >
            <i class="fas fa-file-excel me-1"></i>Tomorrow's Summary (Excel)
          </button>
          <hr class="my-2" />
          <button
            class="btn btn-outline-secondary btn-sm"
            onclick="showHelpModal()"
          >
            <i class="fas fa-question-circle me-1"></i>Help & Documentation
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Debug Information (for admins only) -->
{% if current_user.role in ['admin', 'manager'] and (not stats or
stats.current_month_bookings == 0) %}
<div class="debug-info mt-4">
  <strong>Debug Information (Admin Only):</strong>
  <br />â€¢ Environment: {{ 'Production' if request.environ.get('SERVER_SOFTWARE')
  else 'Development' }} <br />â€¢ Stats object exists: {{ 'Yes' if stats else 'No'
  }} {% if stats %} <br />â€¢ Stats data: {{ stats|tojson }} {% endif %} <br />â€¢
  Current time: {{ now.strftime('%Y-%m-%d %H:%M:%S CAT') if now else 'Unknown'
  }} <br />â€¢ User role: {{ current_user.role if current_user.is_authenticated
  else 'Not authenticated' }}
  <div class="mt-2">
    <a
      href="/debug/production-stats"
      target="_blank"
      class="btn btn-sm btn-outline-secondary"
    </div>
  </div>

  <!-- Main Reports Grid -->
  <div class="reports-grid">
    <!-- Daily Summary Report -->
    <div
      class="report-card daily-report animate-in"
      style="animation-delay: 0.6s"
    >
      <div class="report-type-badge">Essential</div>
      <div class="report-header">
        <div class="report-icon-wrapper">
          <i class="fas fa-calendar-day"></i>
        </div>
        <h3 class="report-title">Daily Summary Report</h3>
        <p class="report-description">
          Comprehensive breakdown of tomorrow's events with detailed scheduling,
          client information, and operational requirements for daily planning.
        </p>
        <ul class="report-features">
          <li>Tomorrow's complete event schedule</li>
          <li>Room assignments and client details</li>
          <li>Attendee counts and special requirements</li>
          <li>Revenue projections and pricing breakdown</li>
          <li>Event timing and duration analysis</li>
        </ul>
      </div>
      <div class="report-footer">
        <div class="report-actions">
          <a
            href="{{ url_for('reports.daily_summary_report') }}"
            class="btn-report"
          >
            <i class="fas fa-eye me-1"></i>
            View Report
          </a>
          <a
            href="#"
            class="btn-download"
            onclick="downloadDailyReport()"
            title="Download Excel"
          >
            <i class="fas fa-download"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Weekly Summary Report -->
    <div
      class="report-card weekly-report animate-in"
      style="animation-delay: 0.7s"
    >
      <div class="report-type-badge">Planning</div>
      <div class="report-header">
        <div class="report-icon-wrapper">
          <i class="fas fa-calendar-week"></i>
        </div>
        <h3 class="report-title">Weekly Summary Report</h3>
        <p class="report-description">
          Week-at-a-glance table view showing all rooms and their scheduled
          events. Perfect for strategic planning and resource allocation across
          the week.
        </p>
        <ul class="report-features">
          <li>7-day room schedule grid view</li>
          <li>All rooms and events in table format</li>
          <li>Client and pricing information display</li>
          <li>Weekly utilization patterns</li>
          <li>Export-ready professional format</li>
        </ul>
      </div>
      <div class="report-footer">
        <div class="report-actions">
          <a
            href="{{ url_for('reports.weekly_summary_report') }}"
            class="btn-report"
          >
            <i class="fas fa-eye me-1"></i>
            View Report
          </a>
          <a
            href="#"
            class="btn-download"
            onclick="downloadWeeklyReport()"
            title="Download Excel"
          >
            <i class="fas fa-download"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Monthly Performance Report -->
    <div
      class="report-card monthly-report animate-in"
      style="animation-delay: 0.8s"
    >
      <div class="report-type-badge">Executive</div>
      <div class="report-header">
        <div class="report-icon-wrapper">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <h3 class="report-title">Monthly Performance Report</h3>
        <p class="report-description">
          Comprehensive monthly analytics combining utilization metrics, revenue
          analysis, and strategic insights for executive decision-making.
        </p>
        <ul class="report-features">
          <li>Monthly revenue and booking analytics</li>
          <li>Room performance comparisons</li>
          <li>Client activity trends and insights</li>
          <li>Utilization vs capacity analysis</li>
          <li>Executive summary with recommendations</li>
        </ul>
      </div>
      <div class="report-footer">
        <div class="report-actions">
          <a
            href="{{ url_for('reports.monthly_summary_report') }}"
            class="btn-report"
          >
            <i class="fas fa-eye me-1"></i>
            View Report
          </a>
          <a
            href="#"
            class="btn-download"
            onclick="downloadMonthlyReport()"
            title="Download Excel"
          >
            <i class="fas fa-download"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- System Status -->
  <div class="system-status animate-in" style="animation-delay: 0.9s">
    <h4 class="actions-title mb-3">
      <i class="fas fa-server me-2"></i>System Status
    </h4>
    <div class="status-item">
      <span class="status-label">Database Connection</span>
      <div class="d-flex align-items-center">
        <span class="status-value" id="dbStatus">Checking...</span>
        <div class="status-indicator" id="dbIndicator"></div>
      </div>
    </div>
    <div class="status-item">
      <span class="status-label">Last Data Sync</span>
      <span class="status-value" id="lastSync">Checking...</span>
    </div>
    <div class="status-item">
      <span class="status-label">Export Services</span>
      <div class="d-flex align-items-center">
        <span class="status-value">Available</span>
        <div class="status-indicator"></div>
      </div>
    </div>
    <div class="status-item">
      <span class="status-label">Current Time (CAT)</span>
      <span class="status-value" id="currentTime"
        >{{ moment().strftime('%I:%M %p, %B %d') if moment else 'Unknown Time'
        }}</span
      >
    </div>
  </div>
</div>

<!-- Custom Date Modal -->
<div
  class="modal fade"
  id="customDateModal"
  tabindex="-1"
  aria-labelledby="customDateModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="customDateModalLabel">
          <i class="fas fa-calendar me-2"></i>Custom Date Range
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="reportType" class="form-label">Report Type</label>
          <select class="form-select" id="reportType">
            <option value="daily">Daily Summary</option>
            <option value="weekly">Weekly Summary</option>
            <option value="monthly">Monthly Report</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="selectedDate" class="form-label">Select Date</label>
          <input type="date" class="form-control" id="selectedDate" />
          <div class="form-text">
            Choose any date within your desired reporting period
          </div>
          <div class="mb-3">
            <label class="form-label">Report Type</label>
            <select
              class="form-control"
              id="reportType"
              name="report_type"
              required
            >
              <option value="">Select a report...</option>
              <option value="room_utilization">Room Utilization</option>
              <option value="daily_summary">Daily Summary</option>
              <option value="weekly_summary">Weekly Summary</option>
              <option value="monthly_report">Monthly Report</option>
            </select>
          </div>
        </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          onclick="generateCustomReport()"
        >
          <i class="fas fa-chart-bar me-1"></i>Generate Report
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log("ðŸ“Š Reports Dashboard initializing...");

    // Load dashboard stats initially
    loadDashboardStats();

    // Set up auto-refresh for dashboard stats every 30 seconds
    setInterval(loadDashboardStats, 30000);

    // Update time every minute
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000);

    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    // Set initial state and observe cards
    reportCards.forEach((card, index) => {
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
      observer.observe(card);
    });

    // Enhanced statistics validation
    const statsData = {{ stats|tojson if stats else '{}' }};
    console.log("ðŸ“ˆ Statistics loaded:", statsData);

    // Validate and handle missing stats
    if (!statsData || Object.keys(statsData).length === 0) {
      console.warn("âš ï¸ No statistics data available");
      showStatsLoadingError();
    } else if (statsData.current_month_bookings === 0 && statsData.current_month_revenue === 0 && statsData.active_rooms === 0) {
      console.warn("âš ï¸ All statistics are zero - possible data issue");
      showStatsValidationWarning();
    } else {
      console.log("âœ… Statistics validation passed");
      hideLoadingStates();
    }
    // Check system status
    checkSystemStatus();
  });

  async function loadDashboardStats() {
    try {
      console.log("ðŸ“ˆ Loading dashboard statistics...");

      // Call the fetch function to get real data
      await fetchDashboardStats();

      console.log("âœ… Dashboard statistics loaded successfully");
    } catch (error) {
      console.error("âŒ Failed to load dashboard statistics:", error);
      showError(
        "Unable to load dashboard statistics. Please refresh the page."
      );
    }
  }

  // Fetch real dashboard stats from API
  async function fetchDashboardStats() {
    // Show refresh indicator
    const refreshIndicator = document.getElementById("refresh-indicator");
    if (refreshIndicator) {
      refreshIndicator.style.display = "block";
    }

    try {
      const response = await fetch("/api/dashboard/stats");
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const stats = await response.json();

      // Update the display with real data
      updateStatDisplay("todayEvents", stats.todayEvents, "events scheduled");
      updateStatDisplay(
        "weeklyRevenue",
        `$${stats.weeklyRevenue.toLocaleString()}`,
        "from confirmed bookings"
      );
      updateStatDisplay(
        "activeRooms",
        stats.activeRooms,
        "available for booking"
      );
      updateStatDisplay(
        "utilization",
        `${stats.utilization}%`,
        getUtilizationText(stats.utilization)
      );

      console.log("âœ… Dashboard stats updated:", stats);
    } catch (error) {
      console.error("âŒ Error fetching dashboard stats:", error);
      // Fallback to show error state
      updateStatDisplay("todayEvents", "Error", "loading failed");
      updateStatDisplay("weeklyRevenue", "Error", "loading failed");
      updateStatDisplay("activeRooms", "Error", "loading failed");
      updateStatDisplay("utilization", "Error", "loading failed");
    } finally {
      // Hide refresh indicator
      if (refreshIndicator) {
        setTimeout(() => {
          refreshIndicator.style.display = "none";
        }, 500);
      }
    }
  }

  function updateStatDisplay(elementId, value, trendText) {
    const valueElement = document.getElementById(elementId);
    const trendElement = document.getElementById(
      elementId
        .replace("Events", "Trend")
        .replace("Revenue", "Trend")
        .replace("Rooms", "Trend")
        .replace("utilization", "utilizationTrend")
    );

    if (valueElement) {
      // Remove loading skeleton
      const skeleton = valueElement.querySelector(".loading-skeleton");
      if (skeleton) {
        skeleton.remove();
      }
      valueElement.textContent = value;
    }

    if (trendElement) {
      trendElement.textContent = trendText;
      trendElement.classList.add("trend-positive");
    }
  }

  function refreshStats() {
    console.log("ðŸ”„ Refreshing statistics...");
    const refreshIcon = document.getElementById('refreshIcon');
    if (refreshIcon) {
      refreshIcon.classList.add('refresh-indicator');
    }
    setTimeout(function() {
      window.location.reload();
    }, 2000);
  }

  function generateTomorrowReport() {
    console.log("ðŸ“… Generating tomorrow's report...");
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const dateStr = tomorrow.toISOString().split('T')[0];

    // Navigate to daily summary with tomorrow's date
    window.location.href = `{{ url_for('daily_summary_report') }}?date=${dateStr}`;
  function getUtilizationText(rate) {
    if (rate >= 80) return "excellent performance";
    if (rate >= 60) return "good utilization";
    if (rate >= 40) return "moderate activity";
    return "room for improvement";
  }

  function updateCurrentTime() {
    const timeElement = document.getElementById("currentTime");
    if (timeElement) {
      const now = new Date();
      const options = {
        timeZone: "Africa/Harare",
        hour: "numeric",
        minute: "2-digit",
        hour12: true,
        month: "long",
        day: "numeric",
      };
      timeElement.textContent = now.toLocaleString("en-US", options);
    }
  }

  async function checkSystemStatus() {
    try {
      const dbStatusElement = document.getElementById("dbStatus");
      const dbIndicatorElement = document.getElementById("dbIndicator");
      const lastSyncElement = document.getElementById("lastSync");

      // Simulate system check
      await new Promise((resolve) => setTimeout(resolve, 1000));

      if (dbStatusElement) {
        dbStatusElement.textContent = "Connected";
        dbStatusElement.style.color = "var(--accent-color)";
      }

      if (dbIndicatorElement) {
        dbIndicatorElement.style.background = "var(--accent-color)";
      }

      if (lastSyncElement) {
        lastSyncElement.textContent = "Just now";
      }
    } catch (error) {
      console.error("System status check failed:", error);
    }
  }

  function showError(message) {
    const errorContainer = document.getElementById("errorContainer");
    if (errorContainer) {
      errorContainer.innerHTML = `
            <div class="error-message">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Error:</strong> ${message}
            </div>
        `;
      errorContainer.style.display = "block";
    }
  }

  // Navigation functions
  function generateTomorrowReport() {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const dateString = tomorrow.toISOString().split("T")[0];
    window.location.href = `{{ url_for('reports.daily_summary_report') }}?date=${dateString}`;
  }

  function generateThisWeekReport() {
    const today = new Date();
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - today.getDay() + 1); // Monday
    const dateString = startOfWeek.toISOString().split("T")[0];
    window.location.href = `{{ url_for('reports.weekly_summary_report') }}?start_date=${dateString}`;
  }

  function generateThisMonthReport() {
    const today = new Date();
    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
    const year = startOfMonth.getFullYear();
    const month = startOfMonth.getMonth() + 1;
    window.location.href = `{{ url_for('reports.monthly_summary_report') }}?year=${year}&month=${month}`;
  }

  function showCustomDateModal() {
    const modal = new bootstrap.Modal(
      document.getElementById("customDateModal")
    );
    modal.show();
  }

  function generateCustomReport() {
    const reportType = document.getElementById("reportType").value;
    const selectedDate = document.getElementById("selectedDate").value;

    if (!selectedDate) {
      alert("Please select a date");
      return;
    }

    if (new Date(startDate) > new Date(endDate)) {
      alert('Start date must be before end date');
      return;
    }
    let url = "";
    const date = new Date(selectedDate);

    switch (reportType) {
      case "daily":
        url = `{{ url_for('reports.daily_summary_report') }}?date=${selectedDate}`;
        break;
      case 'daily_summary':
        reportUrl = `{{ url_for('daily_summary_report') }}?date=${startDate}`;
        break;
      case 'weekly_summary':
        reportUrl = `{{ url_for('weekly_summary_report') }}?start_date=${startDate}&end_date=${endDate}`;
        break;
      case 'monthly_report':
        reportUrl = `{{ url_for('monthly_report') }}?start_date=${startDate}&end_date=${endDate}`;
        break;
    }

    if (reportUrl) {
      const modal = bootstrap.Modal.getInstance(document.getElementById('dateRangeModal'));
      modal.hide();
      window.location.href = reportUrl;
      case "weekly":
        url = `{{ url_for('reports.weekly_summary_report') }}?start_date=${selectedDate}`;
        break;
      case "monthly":
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        url = `{{ url_for('reports.monthly_summary_report') }}?year=${year}&month=${month}`;
        break;
    }

    if (url) {
      bootstrap.Modal.getInstance(
        document.getElementById("customDateModal")
      ).hide();
      window.location.href = url;
    }
  }

  // Download functions
  function downloadDailyExcel() {
    const today = new Date().toISOString().split('T')[0];
    window.location.href = `/reports/daily-summary/download?format=excel&date=${today}`;
  }

  function downloadDailyPDF() {
    const today = new Date().toISOString().split('T')[0];
    window.location.href = `/reports/daily-summary/download?format=pdf&date=${today}`;
  }

  function downloadWeeklyExcel() {
    window.location.href = `/reports/weekly-summary/download?format=excel`;
  }

  function downloadWeeklyPDF() {
    window.location.href = `/reports/weekly-summary/download?format=pdf`;
  }

  function downloadMonthlyExcel() {
    window.location.href = `/reports/monthly-report/download?format=excel`;
  }

  function downloadMonthlyPDF() {
    window.location.href = `/reports/monthly-report/download?format=pdf`;
  }

  function downloadTodayReport() {
    const today = new Date().toISOString().split('T')[0];
    window.location.href = `/reports/daily-summary/download?format=excel&date=${today}`;
  }

  function downloadTomorrowReport() {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const dateStr = tomorrow.toISOString().split('T')[0];
    window.location.href = `/reports/daily-summary/download?format=excel&date=${dateStr}`;
  }

  function showStatsDetails(statType) {
    const statsData = {{ stats|tojson if stats else '{}' }};
    const modal = new bootstrap.Modal(document.getElementById('statsDetailsModal'));
    const content = document.getElementById('statsDetailsContent');

    let detailsHTML = '';

    switch(statType) {
      case 'today':
        detailsHTML = `
          <h6>Today's Events</h6>
          <p><strong>Active Events:</strong> ${statsData.current_month_bookings || 0}</p>
          <p><strong>Revenue Today:</strong> $${(statsData.current_month_revenue || 0).toFixed(2)}</p>
          <hr>
          <small class="text-muted">Shows all confirmed events scheduled for today.</small>
        `;
        break;
      case 'week':
        detailsHTML = `
          <h6>This Week's Performance</h6>
          <p><strong>Weekly Revenue:</strong> $${(statsData.current_month_revenue || 0).toFixed(2)}</p>
          <p><strong>Average per Event:</strong> $${(statsData.avg_booking_value || 0).toFixed(2)}</p>
          <hr>
          <small class="text-muted">Includes all confirmed bookings for the current week.</small>
        `;
        break;
      case 'rooms':
        detailsHTML = `
          <h6>Active Rooms</h6>
          <p><strong>Total Active Rooms:</strong> ${statsData.active_rooms || 0}</p>
          <p><strong>Status:</strong> Available for booking</p>
          <hr>
          <small class="text-muted">Rooms that are operational and available for reservations.</small>
        `;
        break;
      case 'utilization':
        detailsHTML = `
          <h6>Room Utilization</h6>
          <p><strong>Current Rate:</strong> ${(statsData.utilization_rate || 0)}%</p>
          <p><strong>Total Booked Hours:</strong> ${(statsData.total_booked_hours || 0)} hours</p>
          <hr>
          <small class="text-muted">Percentage of available room hours that are actually booked.</small>
        `;
        break;
    }

    content.innerHTML = detailsHTML;
    modal.show();
  }

  function showHelpModal() {
    alert('Help documentation will be available soon. Please contact your administrator for assistance.');
  }

  // Debug information for development
  {% if current_user.role in ['admin', 'manager'] %}
  console.log("ðŸ”§ Debug information available:");
  console.log("Environment:", "{{ 'Production' if request.environ.get('SERVER_SOFTWARE') else 'Development' }}");
  console.log("Stats object exists:", {{ 'true' if stats else 'false' }});
  console.log("Current user role:", "{{ current_user.role if current_user.is_authenticated else 'Not authenticated' }}");
  {% endif %}
  function downloadDailyReport() {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const dateString = tomorrow.toISOString().split("T")[0];
    window.location.href = `{{ url_for('reports.export_daily_summary') }}?date=${dateString}&format=excel`;
  }

  function downloadWeeklyReport() {
    const today = new Date();
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - today.getDay() + 1);
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6);

    const startDate = startOfWeek.toISOString().split("T")[0];
    const endDate = endOfWeek.toISOString().split("T")[0];

    window.location.href = `{{ url_for('reports.export_weekly_summary') }}?start_date=${startDate}&end_date=${endDate}&format=excel`;
  }

  function downloadMonthlyReport() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1;
    window.location.href = `{{ url_for('reports.export_monthly_summary') }}?year=${year}&month=${month}&format=excel`;
  }

  // Add smooth scroll behavior for better UX
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute("href"));
      if (target) {
        target.scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }
    });
  });
</script>
{% endblock %}
